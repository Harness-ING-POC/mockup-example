template:
  name: Route traffic
  type: StepGroup
  projectIdentifier: ing175ip1
  orgIdentifier: ing175org
  spec:
    steps:
      - step:
          type: K8sApply
          name: "Route traffic "
          identifier: Route_traffic
          spec:
            skipDryRun: false
            skipSteadyStateCheck: false
            skipRendering: false
            overrides: []
            manifestSource:
              type: K8sManifest
              spec:
                store:
                  type: Github
                  spec:
                    connectorRef: githubaccount
                    paths:
                      - examples/service.yaml
                    gitFetchType: Branch
                    branch: main
          timeout: 10m
      - step:
          type: Verify
          name: Auto canary analysis
          identifier: Auto_canary_analysis
          spec:
            isMultiServicesOrEnvs: false
            type: Auto
            monitoredService:
              type: Default
              spec: {}
            spec:
              sensitivity: HIGH
              duration: 15m
          timeout: 2h
          failureStrategies:
            - onFailure:
                errors:
                  - Verification
                action:
                  type: ManualIntervention
                  spec:
                    timeout: 2h
                    onTimeout:
                      action:
                        type: StageRollback
            - onFailure:
                errors:
                  - Unknown
                action:
                  type: ManualIntervention
                  spec:
                    timeout: 2h
                    onTimeout:
                      action:
                        type: Ignore
    stageType: Deployment
    strategy:
      matrix:
        service: <+json.list("weights", <+pipeline.variables.services>)>
  identifier: Route_traffic
  versionLabel: v1
